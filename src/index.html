<!DOCTYPE html>
<html>

<head>
  <title>Neighborhood map</title>
  <meta name="viewport" content="initial-scale=1.0">
  <meta charset="utf-8">
  <link rel="stylesheet" href="/styles/main.css">
  <style>
    #map {
      height: 100%;
    }

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>
</head>

<body>
  <div class="sidebar">
    <h1 class="sidebar__title">App name</h1>
    <div class="sidebar__toolbar">
      <form>
        <input type="text" name="" value="Filter list...">
      </form>
    </div>
    <div class="list">
      <ul>
        <li class="list__item">
          <img class="list__item__thumb" src="" alt="Location title">
          <h3 class="list__item__title">Location title</h3>
          <p class="list__item__info">Location description</p>
        </li>
      </ul>
    </div>
  </div>
  <div id="map"></div>
  <script>
    // Define global variables
    var GOOGLE_API_KEY = 'AIzaSyBIRCqEqa2xArP3H7oKIPsm7zPimNh5FDE'; // TODO: Use the key properly
    var map, marker, center, infowindow;
    var markers = [];

    // TODO: Use API for information about locations
    var locations = [{
        title: 'Izhevsk',
        description: 'Short text about Izhevks',
        location: {
          lat: 56.85,
          lng: 53.20
        }
      },
      {
        title: 'Sarapul',
        description: 'Short text about Sarapul',
        location: {
          lat: 56.28,
          lng: 53.48
        }
      },
      {
        title: 'Mozhga',
        description: 'Short text about Mozhga',
        location: {
          lat: 56.27,
          lng: 52.13
        }
      }
    ];

    function initMap() {

      // Initialize map
      map = new google.maps.Map(document.getElementById('map'), {
        center: locations[0].location,
        zoom: 8
      });

      // Show markers on the map
      for (var i = 0; i < locations.length; i++) {
        marker = new google.maps.Marker({
          position: locations[i].location,
          title: locations[i].title,
          description: locations[i].description,
          map: map
        });
        markers.push(marker);
        marker.addListener('click', function() {
          popuplateInfoWindow(this, infowindow);
        });
      }

      infowindow = new google.maps.InfoWindow({
        content: locations.description
      });

      // Popuplate infowindow with marker's data
      function popuplateInfoWindow(marker, infowindow) {
        // Check if infowindow is not opened
        if (infowindow.marker != marker) {
          infowindow.marker = marker;
          infowindow.setContent(
            '<h1>' + marker.title + '</h1>' +
            '<p>' + marker.description + '</p>');
          infowindow.open(map, marker);
          infowindow.addListener('closeclick', function() {
            infowindow.setMarker(null);
          });
        }
      }

      // Show infowindow on marker click
      marker.addListener('click', function() {
        infowindow.open(map, marker);
      });
    }
  </script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBIRCqEqa2xArP3H7oKIPsm7zPimNh5FDE&callback=initMap" async defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-min.js" integrity="sha256-PX9zWVaICUCeklczWaS9DLBb9uGN7pCkCT0Kyz1elRo=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>

</body>

</html>
